<section class="grid-two" id="controlPlaneSection">
  <article class="panel" id="cpPanel">
    <h2>Control Plane</h2>
    <p class="panel-hint">
      Real-time transactional AI tuning. Advanced options are hidden by default
      (Progressive Disclosure).
    </p>

    <div
      class="form-row"
      style="align-items: center; margin-bottom: var(--spacing-3)"
    >
      <span id="cpModeChip" class="chip pending">MODE</span>
      <span id="cpResponseContract" class="chip"
        >Active contract: 1 message / 4 lines.</span
      >
    </div>
    <p
      id="cpCapabilitiesLine"
      class="panel-hint"
      style="margin-bottom: var(--spacing-5)"
    >
      Loading capabilities...
    </p>

    <div
      style="
        margin-bottom: var(--spacing-4);
        padding: var(--spacing-4);
        background: var(--bg-base);
        border-radius: var(--radius-md);
        border: 1px solid var(--border-default);
      "
    >
      <div
        class="form-row"
        style="
          align-items: center;
          justify-content: space-between;
          gap: var(--spacing-3);
          margin-bottom: var(--spacing-2);
        "
      >
        <div
          class="form-row"
          style="align-items: center; gap: var(--spacing-2); margin: 0"
        >
          <span class="chip">Operational Control</span>
          <span id="cpAgentStatusChip" class="chip pending">RUNNING</span>
        </div>
        <div class="form-row" style="gap: var(--spacing-2); margin: 0">
          <button id="cpSuspendBtn" class="btn btn-danger" type="button">
            Panic Suspend
          </button>
          <button id="cpResumeBtn" class="btn btn-secondary" type="button">
            Resume Agent
          </button>
        </div>
      </div>
      <p id="cpAgentStatusHint" class="panel-hint" style="margin: 0">
        Operational agent.
      </p>
    </div>

    <div
      style="
        margin-bottom: var(--spacing-4);
        padding: var(--spacing-4);
        background: var(--bg-base);
        border-radius: var(--radius-md);
        border: 1px solid var(--border-default);
      "
    >
      <div
        class="form-row"
        style="
          align-items: center;
          justify-content: space-between;
          gap: var(--spacing-3);
          margin-bottom: var(--spacing-2);
        "
      >
        <div
          class="form-row"
          style="align-items: center; gap: var(--spacing-2); margin: 0"
        >
          <span class="chip">Channel Directives</span>
          <span id="cpChannelConfigStatusChip" class="chip pending"
            >MODEL DEFAULT</span
          >
          <span id="cpAgentNotesStatusChip" class="chip pending"
            >NOTES CLEAR</span
          >
        </div>
        <div class="form-row" style="gap: var(--spacing-2); margin: 0">
          <button
            id="cpLoadChannelConfigBtn"
            class="btn btn-secondary"
            type="button"
          >
            Load Channel
          </button>
          <button
            id="cpSaveChannelConfigBtn"
            class="btn btn-primary"
            type="button"
          >
            Apply Directives
          </button>
        </div>
      </div>
      <div
        class="form-row"
        style="flex-wrap: wrap; margin-bottom: var(--spacing-2)"
      >
        <div class="form-group" style="min-width: 170px">
          <label for="cpChannelConfigId">Channel</label>
          <input
            id="cpChannelConfigId"
            class="form-control"
            type="text"
            value="default"
          />
        </div>
        <div class="form-group" style="min-width: 150px">
          <label for="cpChannelTemperature">Temperature</label>
          <input
            id="cpChannelTemperature"
            class="form-control"
            type="number"
            min="0"
            max="2"
            step="0.01"
            placeholder="0.15"
          />
        </div>
        <div class="form-group" style="min-width: 150px">
          <label for="cpChannelTopP">Top P</label>
          <input
            id="cpChannelTopP"
            class="form-control"
            type="number"
            min="0"
            max="1"
            step="0.01"
            placeholder="auto"
          />
        </div>
        <div class="form-group" style="min-width: 220px">
          <label class="toggle-switch" style="margin-top: 1.4rem">
            <input id="cpChannelAgentPaused" type="checkbox" />
            <span class="toggle-slider"></span>
            Pause/Silence on this channel
          </label>
        </div>
      </div>
      <div
        class="form-row"
        style="
          align-items: center;
          gap: var(--spacing-2);
          margin-bottom: var(--spacing-2);
        "
      >
        <span class="chip">Channel Identity</span>
        <span id="cpChannelIdentityStatusChip" class="chip pending"
          >IDENTITY CLEAR</span
        >
      </div>
      <div
        class="form-row"
        style="flex-wrap: wrap; margin-bottom: var(--spacing-2)"
      >
        <div class="form-group" style="min-width: 220px">
          <label for="cpChannelPersonaName">Persona Name</label>
          <input
            id="cpChannelPersonaName"
            class="form-control"
            type="text"
            maxlength="80"
            placeholder="e.g. Byte Coach"
          />
        </div>
        <div class="form-group" style="min-width: 280px">
          <label for="cpChannelTone">Tone</label>
          <input
            id="cpChannelTone"
            class="form-control"
            type="text"
            maxlength="160"
            placeholder="e.g. tactical, objective, spoiler-free"
          />
        </div>
      </div>
      <div
        class="form-row"
        style="flex-wrap: wrap; margin-bottom: var(--spacing-2)"
      >
        <div class="form-group" style="min-width: 260px; flex: 1">
          <label for="cpChannelEmoteVocab">Emote Vocab (csv)</label>
          <input
            id="cpChannelEmoteVocab"
            class="form-control"
            type="text"
            maxlength="720"
            placeholder="e.g. PogChamp, Kappa, LUL"
          />
        </div>
      </div>
      <div class="form-group" style="margin-bottom: var(--spacing-2)">
        <label for="cpChannelLore">Lore / Continuity</label>
        <textarea
          id="cpChannelLore"
          class="form-control"
          rows="3"
          maxlength="1200"
          placeholder="Recurring channel context to keep reply continuity."
        ></textarea>
      </div>
      <div class="form-group" style="margin-bottom: var(--spacing-2)">
        <label for="cpAgentNotes">Operational Notes</label>
        <textarea
          id="cpAgentNotes"
          class="form-control"
          rows="4"
          placeholder="e.g. Prioritize streamer lore/context. Avoid aggressive backseating."
        ></textarea>
      </div>
      <p
        id="cpChannelConfigHint"
        class="panel-hint"
        style="margin: 0 0 var(--spacing-1) 0"
      >
        Overrides persisted in <code>channels_config</code>.
      </p>
      <p
        id="cpChannelIdentityHint"
        class="panel-hint"
        style="margin: 0 0 var(--spacing-1) 0"
      >
        Identity persisted in <code>channel_identity</code> and applied to the
        system prompt.
      </p>
      <p id="cpAgentNotesHint" class="panel-hint" style="margin: 0">
        Notes persisted in <code>agent_notes</code> and injected into the
        prompt.
      </p>
    </div>

    <div class="form-row" style="flex-wrap: wrap">
      <div class="form-group" style="min-width: 170px">
        <label class="toggle-switch">
          <input id="cpAutonomyEnabled" type="checkbox" />
          <span class="toggle-slider"></span>
          Global Autonomy
        </label>
      </div>
    </div>

    <details class="advanced-settings">
      <summary>Advanced Budget & Cooldown Settings</summary>
      <div class="advanced-settings-content">
        <div
          class="form-row"
          style="flex-wrap: wrap; margin-bottom: var(--spacing-4)"
        >
          <div class="form-group" style="min-width: 140px">
            <label for="cpHeartbeatInterval">Heartbeat (s)</label>
            <input
              id="cpHeartbeatInterval"
              class="form-control"
              type="number"
              min="15"
              max="3600"
              step="1"
            />
          </div>
          <div class="form-group" style="min-width: 140px">
            <label for="cpMinCooldown">Cooldown (s)</label>
            <input
              id="cpMinCooldown"
              class="form-control"
              type="number"
              min="15"
              max="3600"
              step="1"
            />
          </div>
          <div class="form-group" style="min-width: 140px">
            <label for="cpActionIgnoreAfter">Auto-ignore (s)</label>
            <input
              id="cpActionIgnoreAfter"
              class="form-control"
              type="number"
              min="60"
              max="86400"
              step="1"
            />
          </div>
        </div>

        <div class="form-row" style="flex-wrap: wrap">
          <div class="form-group" style="min-width: 140px">
            <label for="cpBudget10m">Budget 10m</label>
            <input
              id="cpBudget10m"
              class="form-control"
              type="number"
              min="0"
              max="100"
              step="1"
            />
          </div>
          <div class="form-group" style="min-width: 140px">
            <label for="cpBudget60m">Budget 60m</label>
            <input
              id="cpBudget60m"
              class="form-control"
              type="number"
              min="0"
              max="600"
              step="1"
            />
          </div>
          <div class="form-group" style="min-width: 140px">
            <label for="cpBudgetDaily">Daily Budget</label>
            <input
              id="cpBudgetDaily"
              class="form-control"
              type="number"
              min="0"
              max="5000"
              step="1"
            />
          </div>
        </div>

        <div
          style="
            margin-top: var(--spacing-4);
            border-top: 1px solid var(--border-default);
            padding-top: var(--spacing-4);
          "
        >
          <h4
            style="
              margin: 0 0 var(--spacing-2) 0;
              font-size: 0.9rem;
              color: var(--text-primary);
            "
          >
            Outbound Webhooks
          </h4>
          <p class="panel-hint" style="margin-bottom: var(--spacing-3)">
            Configure an endpoint to receive agent events (Phase 18).
          </p>
          <div
            class="form-row"
            style="flex-wrap: wrap; margin-bottom: var(--spacing-2)"
          >
            <div class="form-group" style="min-width: 220px; flex: 2">
              <label for="cpWebhookUrl">Webhook URL</label>
              <input
                id="cpWebhookUrl"
                class="form-control"
                type="url"
                placeholder="https://api.example.com/webhooks/byte"
              />
            </div>
            <div class="form-group" style="min-width: 180px; flex: 1">
              <label for="cpWebhookSecret">HMAC Secret (optional)</label>
              <input
                id="cpWebhookSecret"
                class="form-control"
                type="password"
                placeholder="Secret for sha256 signing"
              />
            </div>
          </div>
          <div
            class="form-row"
            style="
              align-items: center;
              justify-content: space-between;
              gap: var(--spacing-3);
            "
          >
            <label class="toggle-switch">
              <input id="cpWebhookActive" type="checkbox" checked />
              <span class="toggle-slider"></span>
              Enable Dispatch
            </label>
            <button
              id="cpWebhookTestBtn"
              class="btn btn-secondary"
              type="button"
            >
              Test Webhook
            </button>
          </div>
        </div>
      </div>
    </details>

    <div
      class="form-row"
      style="
        justify-content: space-between;
        align-items: center;
        margin-top: var(--spacing-5);
      "
    >
      <h3 style="margin: 0">Goals Scheduler</h3>
      <button id="cpAddGoalBtn" class="btn btn-secondary" type="button">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <line x1="12" y1="5" x2="12" y2="19"></line>
          <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Add Goal
      </button>
    </div>
    <ul
      id="cpGoalsList"
      class="events-list"
      style="margin-top: var(--spacing-3)"
    ></ul>

    <div class="form-row" style="margin-top: var(--spacing-5)">
      <button id="cpSaveBtn" class="btn btn-primary" type="button">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
          ></path>
          <polyline points="17 21 17 13 7 13 7 21"></polyline>
          <polyline points="7 3 7 8 15 8"></polyline>
        </svg>
        Save Config
      </button>
      <button id="cpReloadBtn" class="btn btn-secondary" type="button">
        Reload
      </button>
    </div>
    <p
      id="cpFeedbackMsg"
      class="panel-hint event-level-info"
      style="margin-top: var(--spacing-2)"
    >
      Waiting for configuration...
    </p>
  </article>
</section>
